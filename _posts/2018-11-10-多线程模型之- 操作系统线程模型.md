---
layout:     post
title:      多线程模型之 - 操作系统线程模型
subtitle:   
date:       2018-11-10
author:     BY
header-img: img/post-bg-unix-linux.jpg
catalog: true
tags:
    - 操作系统
    - 多线程
---

> 在工作的前两年内，我工作的主要语言在golang，我们都知道go的性能比较好，尤其在处理CPU密集型计算的情况下，而JAVA是我这一年的重点工作语言，自然而然，我会将他们两者相比较。

这我准备出个系列，主要分成4部分，分别讲操作系统，JAVA，Go，以及最终章的实例比较。

今天先聊一聊操作系统线程实现方式

#### 操作系统线程实现方式

操作系统线程实现方式主要分为以下两种：

1. 内核支持线程
2. 用户级线程
3. 内核级用户级的组合方式

##### 内核支持线程

所谓的内核支持线程，是在内核支持下运行的。无论是用户进程中的线程，还是操作系统中的线程，他们的创建，撤销，切换等都是依靠内核。内核为每个内核支持线程设置了一个线程控制块，内核根据该控制块而感知线程的存在，并加以控制。

对于内核态的线程而言，他提高了系统的执行速度和效率，内核自由调度进程中的线程，提高了CPU的运算效率。

对于用户的线程而言，他的缺点也是比较明显，在用户做线程切换的时候，开销较大，每次从一个线程切换到另外一个线程时，需要从用户态切到内核态进行。

##### 用户级线程

用户级线程仅仅存在于用户空间，无论是线程的创建，撤销，同步，切换等都无需利用操作系统来实现。

这样做有着显而易见的优点

- 线程切换不需要经过内核态，节省了模式切换的开销，更加节省了内核宝贵的资源
- 调度算法可由用户态自己实现，不受系统调度的影响
- 与操作系统的平台无关，无论是Linux，windows等操作系统

缺点：

- 系统阻塞，我们知道线程是基于进程的，当线程执行一个系统调度时，不仅该线程会阻塞，该进程内的线程都会阻塞
- 在纯用户级线程实现中，多线程应用不能利用多CPU进行多重处理，内核每次只分配给进程的只有一个CPU，会造成资源的浪费。

##### 组合

组合方式其实是对以上两个模式的整合，他实现了两者的优点。内核支持多线程的建立，调度和管理，同时允许用户应用程序建立，调度管理用户线程


#### 线程模型

##### 一对一模型

该模型为每一个用户线程都设置了一个内核控制线程与之连接，当一个线程阻塞时候，允许调度另一个线程运行。在多处理器中，则有多个线程并行执行

该模型的并行能力较强，但每次创建一个用户线程相应就要创建一个内核线程，开销较大。

##### 多对一模型

将多个用户线程映射到一个内核控制线程，这些线程都属于一个一个进程，运行在进程的用户空间中，而对于这些线程的调度和管理都是在进程的用户空间中完成。每次访问内核时候，将其映射到一个内核态线程上，每次只允许一个线程进行创建。

该模型的线程管理开销小，效率高。但当一个线程在访问内核时发生阻塞，则整个进程都会阻塞。

##### 多对多模型

该模型结合上述两者的优点，将多个用户线程映射到多个内核控制线程，内核控制线程的数目可以根据应用进程和系统的不同变化，可以比用户线程少，也可以不同







 